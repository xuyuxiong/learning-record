# SSR
## 有没有做过同构组件？服务端和客户端怎么同步状态的？

## render 和 renderToString 的底层实现上的区别？

## SSR实现原理
[](https://juejin.cn/post/6890810591968477191)
### 先明白两个概念：
- SPA
单页面应用程序，是前后端分离时提出的一种解决方案。在一个应用或者站点中，只有一个完整的html页面，这个页面有一个容器root节点，可以把需要加载的代码片段插入到该容器中。SPA的工作原理：采用的前端路由跳转子页面系统，通过改变页面的URL，在不重新请求页面的情况下，实现局部更新页面视图。
- SEO
搜索引擎优化，利用搜索引擎的规则提高网站在有关搜索引擎内的自然排名。
SEO的工作原理：网页在被请求的时候，从服务器发出的内容可以被搜索引擎的爬虫爬到数据，这个时候从搜索引擎搜索的关键字包含在这些内容中，那么这个网址的信息就更容易显示在搜索结果中。
### 同构渲染
一套代码在服务端上运行一遍到客户端后又运行一遍。服务端完成页面结构，客户端渲染绑定事件。
### 为什么能实现同构渲染
- Node.js存在
- 虚拟DOM存在
### react如何实现同构渲染
1. 同构路由
2. 同构视图
3. 同构数据获取
4. 同构状态管理
### 常见问题
1. 什么是同构渲染？同构渲染其实就是将同一套react代码在服务端执行一遍渲染静态页面，又在客户端执行一遍完成事件绑定。
2. 为什么react需要在服务端执行一遍，又在客户端执行一遍?/为什么服务端渲染完成的页面结构事件绑定无效？原因很简单，服务端使用 renderToString 渲染页面，而 react-dom/server 下的 renderToString 并没有做事件相关的处理，因此返回给浏览器的内容不会有事件绑定，渲染出来的页面只是一个静态的 HTML 页面。只有在客户端渲染 React 组件并初始化 React 实例后，才能更新组件的 state 和 props，初始化 React 的事件系统，执行虚拟 DOM 的重新渲染机制，让 React 组件真正“ 动” 起来。
3. 服务器端已经渲染了一次 React 组件，如果在客户端中再渲染一次 React 组件，会不会渲染两次 React 组件？答案是不会的。秘诀在于 data-react-checksum 属性，上文有说过，如果使用 renderToString 渲染组件，会在组件的第一个 DOM 带有 data-react-checksum 属性，这个属性是通过 adler32 算法算出来：如果两个组件有相同的 props 和 DOM 结构时，adler32 算法算出的 checksum 值会一样，有点类似于哈希算法。所以当客户端渲染 React 组件时，首先计算出组件的 checksum 值，然后检索 HTML DOM 看看是否存在数值相同的data-react-checksum属性，如果存在，则组件只会渲染一次，如果不存在，则会抛出一个 warning 异常。也就是说，当服务器端和客户端渲染具有相同的 props 和相同 DOM 结构的组件时，该 React 组件只会渲染一次。
4. 同构应用最重要的特点?同构应用最重要的特点：只有首屏是服务端渲染（目的：加快首屏渲染，优化SEO），之后的页面跳转通过前端路由进行，遵循SPA（目的：支持局部刷新，前后端分离，减轻服务器压力。
5. 同构应用带来的问题?上面只讲了同构渲染的优点，但其实同构渲染的引发的问题也不少，比如：

不能在服务端渲染期间操作  DOM、BOM api，比如 document、window对象等，应尽量避免在首屏逻辑使用到它们
增加了代码的复杂度，某些代码操作需要区分运行环境
要注意不打包只在服务端运行的外部扩展库，否则会造成构建后的文件体积过大

6. 同构应用使用建议

首屏渲染速度是否真的重要
SEO是否真的需要
